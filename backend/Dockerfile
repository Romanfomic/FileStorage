# Используем официальный образ Go
FROM golang:1.24-alpine as builder

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Копируем все исходные файлы из локальной папки в контейнер
COPY . .

# Устанавливаем зависимости (если используете Go Modules)
RUN go mod tidy

# Собираем бинарный файл
RUN go build -o backend .

# Теперь находимся в альпийском образе с более лёгким окружением
FROM alpine:latest

# Устанавливаем необходимые библиотеки (если требуется)
RUN apk --no-cache add ca-certificates

# Копируем собранный бинарный файл из предыдущего этапа
COPY --from=builder /app/backend /usr/local/bin/backend

# Открываем порт, который будет слушать ваше приложение
EXPOSE 8080

# Команда запуска приложения
CMD ["backend"]
